{% extends "base.html" %}

{% block title %}ç”Ÿæˆç»“æœ - LandPPT{% endblock %}

{% block content %}
{% if success %}
<div class="alert alert-success">
    <h3 style="margin-bottom: 10px;">ğŸ‰ PPT ç”ŸæˆæˆåŠŸï¼</h3>
    <p>æ‚¨çš„ PPT å·²ç»æˆåŠŸç”Ÿæˆï¼Œå¯ä»¥é¢„è§ˆå’Œä¸‹è½½ã€‚</p>
</div>

<div style="text-align: center; margin-bottom: 30px;">
    <h2 style="color: #2c3e50; margin-bottom: 20px;">ğŸ“Š ç”Ÿæˆç»“æœ</h2>
    <p style="color: #7f8c8d;">ä»»åŠ¡ID: <code>{{ task_id }}</code></p>
</div>

<div class="grid">
    <div class="card">
        <h3 style="color: #3498db; margin-bottom: 15px;">ğŸ“‹ PPT å¤§çº²</h3>
        {% if outline %}
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
            <h4 style="color: #2c3e50; margin-bottom: 15px;">{{ outline.title }}</h4>
            <p style="color: #7f8c8d; margin-bottom: 15px;">
                æ€»å…± {{ outline.metadata.total_slides }} é¡µå¹»ç¯ç‰‡ | 
                åœºæ™¯: {{ outline.metadata.scenario }} | 
                è¯­è¨€: {{ outline.metadata.language }}
            </p>
            
            <div style="max-height: 300px; overflow-y: auto;">
                {% for slide in outline.slides %}
                <div style="padding: 10px; margin-bottom: 10px; background: white; border-radius: 5px; border-left: 4px solid #3498db;">
                    <strong>ç¬¬{{ slide.id }}é¡µ: {{ slide.title }}</strong>
                    {% if slide.subtitle %}
                    <br><em style="color: #7f8c8d;">{{ slide.subtitle }}</em>
                    {% endif %}
                    {% if slide.content %}
                    <div style="margin-top: 8px; font-size: 0.9em; color: #555;">
                        {{ slide.content[:100] }}{% if slide.content|length > 100 %}...{% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <div style="text-align: center;">
            <a href="/projects" class="btn btn-primary">æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨</a>
        </div>
    </div>
    
    <div class="card">
        <h3 style="color: #27ae60; margin-bottom: 15px;">ğŸ¯ æ“ä½œé€‰é¡¹</h3>
        
        <div style="margin-bottom: 20px;">
            <a href="/preview/{{ task_id }}" class="btn btn-success" target="_blank" style="width: 100%; margin-bottom: 10px;">
                ğŸ” é¢„è§ˆ PPT
            </a>

            <button onclick="downloadPPT('{{ task_id }}')" class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">
                ğŸ’¾ ä¸‹è½½ PPT
            </button>

            <a href="/scenarios" class="btn btn-warning" style="width: 100%; margin-bottom: 10px;">
                ğŸ”„ åˆ›å»ºæ–°çš„ PPT
            </a>

            <a href="/projects" class="btn" style="background: #9b59b6; width: 100%;">
                ğŸ“Š æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®
            </a>
        </div>
        
        <div style="padding: 15px; background: #e8f4fd; border-radius: 8px; border-left: 4px solid #3498db;">
            <h4 style="color: #2c3e50; margin-bottom: 10px;">ğŸ’¡ æç¤º</h4>
            <ul style="color: #7f8c8d; margin: 0; padding-left: 20px;">
                <li>ç‚¹å‡»"é¢„è§ˆ PPT"å¯ä»¥åœ¨æ–°çª—å£ä¸­æŸ¥çœ‹å®Œæ•´çš„æ¼”ç¤ºæ–‡ç¨¿</li>
                <li>PPT æ”¯æŒé”®ç›˜å¯¼èˆªï¼ˆå·¦å³ç®­å¤´é”®ï¼‰</li>
                <li>å¦‚éœ€ä¿®æ”¹ï¼Œå¯ä»¥é‡æ–°ç”Ÿæˆæˆ–è”ç³»æŠ€æœ¯æ”¯æŒ</li>
            </ul>
        </div>
    </div>
</div>

{% if slides_html %}
<div style="margin-top: 30px;">
    <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">ğŸ¬ PPT é¢„è§ˆ</h3>
    <div style="border: 2px solid #ecf0f1; border-radius: 10px; overflow: hidden; background: white;">
        <iframe 
            srcdoc="{{ slides_html | replace('"', '&quot;') }}" 
            style="width: 100%; height: 600px; border: none;"
            title="PPT Preview">
        </iframe>
    </div>
</div>
{% endif %}

{% else %}
<div class="alert alert-error">
    <h3 style="margin-bottom: 10px;">âŒ ç”Ÿæˆå¤±è´¥</h3>
    <p>å¾ˆæŠ±æ­‰ï¼ŒPPT ç”Ÿæˆè¿‡ç¨‹ä¸­å‡ºç°äº†é”™è¯¯ã€‚</p>
    {% if error %}
    <div style="margin-top: 15px; padding: 10px; background: rgba(231, 76, 60, 0.1); border-radius: 5px;">
        <strong>é”™è¯¯è¯¦æƒ…:</strong> {{ error }}
    </div>
    {% endif %}
</div>

<div style="text-align: center; margin-top: 30px;">
    <a href="/scenarios" class="btn btn-primary">ğŸ”„ é‡æ–°å°è¯•</a>
    <a href="/home" class="btn" style="background: #95a5a6; margin-left: 10px;">ğŸ  è¿”å›é¦–é¡µ</a>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
function downloadPPT(taskId) {
    // In a real implementation, this would trigger a download
    // For now, we'll show an alert
    alert('ä¸‹è½½åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ã€‚æ‚¨å¯ä»¥é€šè¿‡é¢„è§ˆé¡µé¢æ‰‹åŠ¨ä¿å­˜ PPT å†…å®¹ã€‚');
    
    // Alternative: Open preview in new window for manual saving
    window.open('/preview/' + taskId, '_blank');
}

// Auto-refresh functionality removed - now using project-based workflow
</script>
{% endblock %}
